# 옵티마이저
DBMS의 핵심 엔진으로 가장 효율적인 방법으로 SQL을 수행할 최적의 처리 경로를 생성해준다
DBMS의 두뇌라고도 불림

SQL를 작성하고 실행하면 옵티마이저는 여러 실행계획을 세우고 최적의 실행계획을 선정하고 그 실행계획에 따라 쿼리를 수행하게된다.
## 옵티마이저 동작방식
![[Pasted image 20250314000152.png]]
1. Parser : SQL문장을 분석하여 문법 검사와 구성요소를 파악하고 파싱 트리로 만든다
2. Optimizer
	1. Query Transformer : 파싱된 SQL를 보고 같은 결과를 도출하되 더 나은 실행계획을 갖는 SQL로 변환이 가능한지 판단하여 변환 작업 수행
	2. Estimator : 시스템 통계정보를 딕셔너리로부터 수집하여 SQL를 실행할 때 소요되는 총비용 계산
	3. Plan Generator : Estimator가 계산한 값을 토대로 후보군이 되는 실행계획을 도출
3. Row-Source Generator : 옵티마이저가 생성한 실행계획을 SQL엔진이 실행 가능한 형태로 코드나 프시저 형태로 생성
4. SQL Engine : SQL 실행
## 종류
![[Pasted image 20250313212705.png]]
옵티마이저는 실행 계획을 세우는 방식에 따라 규칙 기반 옵티마이저, 비용 기반 옵티마이저로 나뉜다.
### 규칙 기반 옵티마이저
규칙 기반 옵티마이저는 사전에 실행속도가 빠른 순으로 세워진 규칙에 따라 우선순위가 높은 방법을 체택하는 방식으로 동작한다. 
![[Pasted image 20250313213803.png]]
규칙은 다음과 같다

예전에는 옵티마이저의 비용 예측 능력이 좋지 않아 규칙 기반 옵티마이저를 많이 사용하였다.
#### 단점
* 사전 규칙 기반이다 보니 더 나은 방법이 있어도 예외적으로 비효율적인 실행 계획을 채택할 수 있다
* Hint와 HASH JOIN은 규칙 기반 이후 나온 개념이라 사용 할 수 없다
### 비용 기반 옵티마이저
비용 기반 옵티마이저는 여러 실행 계획을 세운 뒤(최대 2천개까지) 비용이 최소한으로 드는 실행 계획을 수행한다
비용기반 옵티마이저는 테이블, 인덱스, 칼럼 등의 다양한 객체 통계정보와 시스템 통계정보를 이용해 비용을 예측한다. 통계정보가 없다면 비효율적인 실행계획을 채택할 수 있어 정확한 통계정보를 유지하는게 중요하다

현재 많이 사용되고 있고 오라클에서는 공식적으로 비용 기반 옵티마이저만 사용한다
#### 비용 기반 옵티마이저 모드
* CHOOSE : 현재는 잘 사용하지 않는다, SQL이 실행되는 환경에 통계 정보를 가져올 수 있다면 비용 기반 그렇지 않다면 규칙 기반 옵티마이저를 동작시킨다
* FIRST_ROWS : 처리결과의 첫 ROW를 출력하는데 걸리는 시간을 최소화 하는 실행계획을 세우는 모드
* FIRST_ROWS_n : 처리결과의 n번째 까지의 ROW를 출력하는데 걸리는 시간을 최소화 하는 실행계획을 세우는 모드
* ALL_ROWS : SQL 실행 결과 전체를 최소화하는 실행계획을 세우는 모드 
  오라클에서는 해당 모드가 기본값
### 주의사항
* 옵티마이징에 직접적으로 영향을 주는 파라미터는 설계단계에서 최적화로 설정해야한다 중간에 변경하면 실행계획 선정이 꼬일 수 있기 때문
* 옵티마이저는 항상 만능은 아니라는것을 숙지해야한다 왜냐하면 옵티마이저가 예외상황까지 계산을 해지 않으니까
###### 참고 및 자료 출처
https://coding-factory.tistory.com/743